{"version":3,"file":"sifrr.animate.js","sources":["../src/bezier.js","../src/types.js","../src/animateone.js","../src/animate.js","../index.js"],"sourcesContent":["const beziers = {};\n\nclass Bezier {\n  constructor(args){\n    const key = args.join('_');\n    if (!beziers[key]) {\n      this.setProps(...args);\n      beziers[key] = this.final.bind(this);\n    }\n    return beziers[key];\n  }\n\n  setProps(x1, y1, x2, y2) {\n    let props = {\n      x1: x1,\n      y1: y1,\n      x2: x2,\n      y2: y2,\n      A: (aA1, aA2) => 1.0 - 3.0 * aA2 + 3.0 * aA1,\n      B: (aA1, aA2) => 3.0 * aA2 - 6.0 * aA1,\n      C: (aA1) => 3.0 * aA1,\n      CalcBezier: (aT, aA1, aA2) => ((this.A(aA1, aA2)*aT + this.B(aA1, aA2))*aT + this.C(aA1))*aT,\n      GetSlope: (aT, aA1, aA2) => 3.0 * this.A(aA1, aA2)*aT*aT + 2.0 * this.B(aA1, aA2) * aT + this.C(aA1)\n    };\n    Object.assign(this, props);\n  }\n\n  final(x) {\n    if (this.x1 == this.y1 && this.x2 == this.y2) return x;\n    return this.CalcBezier(this.GetTForX(x), this.y1, this.y2);\n  }\n\n  GetTForX(xx) {\n    let t = xx;\n    for (let i = 0; i < 4; ++i) {\n      let slope = this.GetSlope(t, this.x1, this.x2);\n      if (slope == 0.0) return t;\n      let x = this.CalcBezier(t, this.x1, this.x2) - xx;\n      t -= x / slope;\n    }\n    return t;\n  }\n}\n\nmodule.exports = Bezier;\n","module.exports = {\n  linear: [0, 0, 1, 1],\n  ease: [.25, .1, .25, 1],\n  easeIn: [.42, 0, 1, 1],\n  easeOut: [0, 0, .58, 1],\n  easeInOut: [.42, 0, .58, 1]\n};\n","const Bezier = require('./bezier');\nconst types = require('./types');\nconst digitRgx = /(\\d+)/;\n\nfunction animateOne({\n  target,\n  prop,\n  from,\n  to,\n  time = 300,\n  type = 'ease',\n  onUpdate,\n  round = false\n} = {}) {\n  const toSplit = to.toString().split(digitRgx), l = toSplit.length, raw = [], fromNums = [], diffs = [];\n  const fromSplit = (from || target[prop] || '').toString().split(digitRgx);\n  const onUp = typeof onUpdate === 'function';\n  for (let i = 0; i < l; i++) {\n    const n = Number(toSplit[i]);\n    if (isNaN(n) || !toSplit[i]) raw.push(toSplit[i]);\n    else {\n      fromNums.push(Number(fromSplit[i]));\n      diffs.push(n - (Number(fromSplit[i]) || 0));\n    }\n  }\n  type = typeof type === 'function' ? type : new Bezier(types[type] || type);\n\n  return new Promise(res => {\n    let startTime;\n    function frame(currentTime) {\n      startTime = startTime || currentTime;\n      const percent = (currentTime - startTime) / time, bper = type(percent);\n      if (percent >= 1) {\n        target[prop] = to;\n        return res();\n      }\n      const next = diffs.map((d, i) => {\n        if (round) return Math.round(bper * d + (fromNums[i] || 0));\n        return bper * d + (fromNums[i] || 0);\n      });\n      const val = String.raw({ raw }, ...next);\n      target[prop] = Number(val) || val;\n      if (onUp) onUpdate(target, prop, val);\n      window.requestAnimationFrame(frame);\n    }\n    window.requestAnimationFrame(frame);\n  });\n}\n\nmodule.exports = animateOne;\n","const animateOne = require('./animateone');\n\nfunction animate({\n  targets,\n  target,\n  to,\n  time,\n  type,\n  onUpdate,\n  round\n} = {}) {\n  targets = targets ? Array.from(targets) : [target];\n  function iterate(target, props) {\n    const promises = [];\n    for (let prop in props) {\n      let from, final;\n      if (Array.isArray(props[prop])) [from, final] = props[prop];\n      else final = props[prop];\n      if (typeof props[prop] === 'object' && !Array.isArray(props[prop])) {\n        promises.push(iterate(target[prop], props[prop]));\n      } else {\n        promises.push(animateOne({\n          target,\n          prop,\n          to: final,\n          time,\n          type,\n          from,\n          onUpdate,\n          round\n        }));\n      }\n    }\n    return Promise.all(promises);\n  }\n  return Promise.all(targets.map(target => iterate(target, to)));\n}\n\nmodule.export = animate;","const animate = require('./src/animate');\nconst types = require('./src/types');\nanimate.types = types;\n\nmodule.exports = {\n  animate,\n  wait: function(time = 0) {\n    return new Promise(res => setTimeout(res, time));\n  }\n};\n"],"names":["beziers","Bezier","constructor","args","key","join","setProps","final","bind","x1","y1","x2","y2","props","A","aA1","aA2","B","C","CalcBezier","aT","GetSlope","Object","assign","x","GetTForX","xx","t","i","slope","linear","ease","easeIn","easeOut","easeInOut","digitRgx","animateOne","target","prop","from","to","time","type","onUpdate","round","toSplit","toString","split","l","length","raw","fromNums","diffs","fromSplit","onUp","n","Number","isNaN","push","types","Promise","res","startTime","frame","currentTime","percent","bper","next","map","d","Math","val","String","window","requestAnimationFrame","animate","targets","Array","iterate","promises","isArray","all","module","export","wait","setTimeout"],"mappings":"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"}